<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      small_count (Money Note) - UI V4 Tabbed Home & Minimal Profile
    </title>
    <style>
      /* --- 1. CSS Variables Definition --- */
      :root {
        /* --- Accent Color Palettes --- */
        --accent-green: #10b981;
        --accent-blue: #3b82f6;
        --accent-purple: #8b5cf6;
        --accent-orange: #f59e0b;

        /* Constants & Default Primary */
        --primary: var(--accent-green);
        /* Default to green */
        --danger: #ef4444;
        --screen-w: 375px;
        --screen-h: 812px;

        /* Light Mode (Default) */
        --bg-app: #f3f4f6;
        --bg-card: #ffffff;
        --bg-modal: #ffffff;
        --text-main: #1f2937;
        --text-sub: #6b7280;
        --text-on-primary: #ffffff;
        --border: #e5e7eb;
        --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --shadow-lg:
          0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);

        --tab-bg: rgba(255, 255, 255, 0.95);
        --key-bg: #ffffff;
        --key-bg-active: #f9fafb;
        --key-bg-special: #e5e7eb;
        --input-bg: #f3f4f6;
        --pill-bg: #e5e7eb;
        --icon-bg: #f3f4f6;

        --cat-selected-bg: #d1fae5;
        --chart-bar-bg: #d1fae5;

        /* Calendar Specific */
        --cal-bg-today: var(--primary);
        --cal-text-today: var(--text-on-primary);
      }

      /* --- 2. Dark Mode Overrides --- */
      [data-theme="dark"] {
        --bg-app: #000000;
        --bg-card: #1c1c1e;
        --bg-modal: #1c1c1e;
        --text-main: #f3f4f6;
        --text-sub: #9ca3af;
        --text-on-primary: #ffffff;
        --border: #2c2c2e;
        --shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        --shadow-lg: 0 15px 25px -5px rgba(0, 0, 0, 0.6);

        --tab-bg: rgba(28, 28, 30, 0.95);
        --key-bg: #2c2c2e;
        --key-bg-active: #3a3a3c;
        --key-bg-special: #1c1c1e;
        --input-bg: #1c1c1e;
        --pill-bg: #2c2c2e;
        --icon-bg: #2c2c2e;

        --cat-selected-bg: rgba(16, 185, 129, 0.2);
        --chart-bar-bg: rgba(16, 185, 129, 0.2);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
          Arial, sans-serif;
        /* Smooth transition for theme & color switch */
        transition:
          background-color 0.3s,
          color 0.3s,
          border-color 0.3s,
          fill 0.3s,
          box-shadow 0.3s;
      }

      body {
        background-color: #121212;
        /* Outer Canvas Darker */
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      /* --- Toolbar --- */
      .toolbar {
        height: 60px;
        background: #1f1f1f;
        color: white;
        display: flex;
        align-items: center;
        padding: 0 24px;
        border-bottom: 1px solid #333;
        justify-content: space-between;
        z-index: 100;
      }

      .toolbar h1 {
        font-size: 18px;
        font-weight: 600;
      }

      .btn-toggle {
        background: #333;
        border: 1px solid #444;
        color: white;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 12px;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .btn-toggle:hover {
        background: #444;
      }

      /* --- Canvas Area --- */
      .canvas {
        flex: 1;
        overflow: auto;
        display: flex;
        padding: 60px;
        gap: 60px;
        align-items: flex-start;
        scrollbar-width: thin;
        scrollbar-color: #555 #1e1e1e;
      }

      /* --- Phone Frame --- */
      .device-mockup {
        width: var(--screen-w);
        height: var(--screen-h);
        background: var(--bg-app);
        border-radius: 40px;
        position: relative;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        overflow: hidden;
        flex-shrink: 0;
        border: 8px solid #1a1a1a;
        /* Phone bezel */
      }

      .notch {
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 120px;
        height: 30px;
        background: #000;
        border-bottom-left-radius: 16px;
        border-bottom-right-radius: 16px;
        z-index: 999;
      }

      /* --- Screen Layouts --- */
      .screen-content {
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        padding-top: 44px;
        padding-bottom: 80px;
        color: var(--text-main);
        /* Global text color */
      }

      .screen-content.no-tab {
        padding-bottom: 0;
      }

      .screen-content::-webkit-scrollbar {
        display: none;
      }

      /* --- Components: Typography --- */
      .h1 {
        font-size: 24px;
        font-weight: 700;
        color: var(--text-main);
      }

      .h2 {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-main);
      }

      .text-sm {
        font-size: 12px;
        color: var(--text-sub);
      }

      .text-md {
        font-size: 14px;
        color: var(--text-main);
      }

      .money-exp {
        color: var(--text-main);
        font-weight: 600;
      }

      .money-inc {
        color: var(--primary);
        font-weight: 600;
      }

      .pill {
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 10px;
        background: var(--pill-bg);
        color: var(--text-sub);
        display: inline-flex;
        align-items: center;
        gap: 2px;
      }

      /* --- Components: Cards & Lists --- */
      .card {
        background: var(--bg-card);
        border-radius: 16px;
        padding: 16px;
        margin: 0 16px 16px 16px;
        box-shadow: var(--shadow);
      }

      .date-header {
        display: flex;
        justify-content: space-between;
        padding: 12px 16px 8px 16px;
        font-size: 12px;
        color: var(--text-sub);
        background: var(--bg-app);
        /* Match app bg for sticky */
        position: sticky;
        top: 0;
        z-index: 10;
        transition: background 0.3s;
      }

      .transaction-item {
        display: flex;
        align-items: center;
        background: var(--bg-card);
        padding: 16px;
        margin-bottom: 1px;
        border-bottom: 1px solid var(--bg-app);
        /* Use bg-app as separator */
      }

      .transaction-item:last-child {
        border-bottom-left-radius: 12px;
        border-bottom-right-radius: 12px;
        border-bottom: none;
      }

      .transaction-item:first-child {
        border-top-left-radius: 12px;
        border-top-right-radius: 12px;
      }

      .t-icon {
        width: 40px;
        height: 40px;
        border-radius: 20px;
        background: var(--icon-bg);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        margin-right: 12px;
        color: var(--text-main);
      }

      .t-info {
        flex: 1;
      }

      .t-amount {
        font-weight: 600;
        font-size: 16px;
        color: var(--text-main);
      }

      /* --- Component: Tab Bar --- */
      .tab-bar {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 80px;
        background: var(--tab-bg);
        backdrop-filter: blur(10px);
        border-top: 1px solid var(--border);
        display: flex;
        justify-content: space-around;
        align-items: flex-start;
        padding-top: 12px;
        z-index: 99;
      }

      .tab-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        color: var(--text-sub);
        font-size: 10px;
        width: 60px;
        cursor: pointer;
      }

      .tab-item.active {
        color: var(--primary);
      }

      .fab {
        width: 56px;
        height: 56px;
        background: var(--primary);
        border-radius: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-on-primary);
        /* Inverted color */
        margin-top: -24px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        font-size: 28px;
        cursor: pointer;
      }

      /* --- Specific Screen: Dashboard (Home) & Internal Tabs --- */
      .dashboard-header {
        padding: 16px;
        /* margin-bottom: 8px; Remove bottom margin for tabs */
      }

      .date-selector {
        display: flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        padding: 4px 8px;
        margin-left: -8px;
        border-radius: 8px;
        transition: background 0.2s;
      }

      .date-selector:active {
        background: var(--icon-bg);
      }

      /* NEW: Home Internal Tabs (Segmented Control style) */
      .home-tabs-control {
        display: flex;
        background: var(--pill-bg);
        /* Use pill background for container */
        border-radius: 10px;
        padding: 4px;
        margin: 0 16px 16px 16px;
      }

      .home-tab-btn {
        flex: 1;
        text-align: center;
        padding: 8px 0;
        font-size: 13px;
        font-weight: 600;
        color: var(--text-sub);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .home-tab-btn.active {
        background: var(--bg-card);
        color: var(--text-main);
        box-shadow: var(--shadow);
      }

      /* Home Tab Content Containers */
      .home-tab-view {
        display: none;
        /* Hidden by default */
        animation: fadeIn 0.3s ease;
      }

      .home-tab-view.active {
        display: block;
        /* Show active */
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(5px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Calendar Widget Styles */
      .calendar-widget {
        padding: 0 16px;
        margin-bottom: 24px;
      }

      .cal-header {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        text-align: center;
        font-size: 12px;
        color: var(--text-sub);
        margin-bottom: 12px;
      }

      .cal-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 10px;
      }

      .cal-day {
        aspect-ratio: 1;
        /* Make cells square */
        background: var(--bg-card);
        border-radius: 14px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        color: var(--text-main);
        position: relative;
        box-shadow: var(--shadow);
        cursor: pointer;
      }

      .cal-date {
        font-weight: 600;
        margin-bottom: 2px;
      }

      .cal-data {
        font-size: 9px;
        line-height: 1.2;
        display: flex;
        flex-direction: column;
        align-items: center;
        font-weight: 500;
      }

      .cal-inc {
        color: var(--primary);
      }

      .cal-exp {
        color: var(--danger);
      }

      .cal-day.is-today {
        background: var(--cal-bg-today);
        color: var(--cal-text-today);
      }

      .cal-day.is-today .cal-inc,
      .cal-day.is-today .cal-exp {
        color: var(--cal-text-today);
        opacity: 0.9;
      }

      .cal-day.not-current {
        opacity: 0.4;
        box-shadow: none;
        background: transparent;
      }

      .overview-card {
        background: var(--primary);
        color: var(--text-on-primary);
        border-radius: 20px;
        padding: 24px;
        margin: 0 16px 24px 16px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      }

      .ov-row {
        display: flex;
        justify-content: space-between;
        margin-top: 16px;
      }

      .ov-item h4 {
        font-size: 12px;
        opacity: 0.8;
        font-weight: 400;
      }

      .ov-item span {
        font-size: 18px;
        font-weight: 600;
      }

      /* --- Specific Screen: Add Transaction --- */
      .add-screen {
        background: var(--bg-modal);
        height: 100%;
        display: flex;
        flex-direction: column;
      }

      .type-switch {
        display: flex;
        justify-content: center;
        padding: 10px 0;
      }

      .ts-btn {
        padding: 8px 24px;
        font-weight: 600;
        color: var(--text-sub);
        border-radius: 20px;
      }

      .ts-btn.active {
        background: var(--bg-app);
        color: var(--text-main);
      }

      .input-area {
        padding: 20px 24px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .input-label {
        font-size: 14px;
        color: var(--text-sub);
      }

      .amount-display {
        font-size: 48px;
        font-weight: 700;
        color: var(--text-main);
      }

      .category-grid {
        flex: 1;
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 16px;
        padding: 0 24px;
        align-content: start;
        overflow-y: auto;
      }

      .cat-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 6px;
        cursor: pointer;
      }

      .cat-icon {
        width: 48px;
        height: 48px;
        background: var(--icon-bg);
        color: var(--text-main);
        border-radius: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        transition: all 0.2s;
      }

      .cat-item.selected .cat-icon {
        background: var(--cat-selected-bg);
        border: 2px solid var(--primary);
        color: var(--text-main);
      }

      .cat-name {
        font-size: 10px;
        color: var(--text-sub);
      }

      .num-pad {
        background: var(--bg-app);
        padding-bottom: 30px;
        display: grid;
        grid-template-columns: 3fr 1fr;
        border-top: 1px solid var(--border);
      }

      .num-keys {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
      }

      .action-keys {
        display: flex;
        flex-direction: column;
      }

      .key {
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        font-weight: 500;
        border-right: 1px solid var(--border);
        border-top: 1px solid var(--border);
        background: var(--key-bg);
        color: var(--text-main);
        cursor: pointer;
      }

      .key:active {
        background: var(--key-bg-active);
      }

      .key-done {
        flex: 1;
        background: var(--primary);
        color: var(--text-on-primary);
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
      }

      /* --- Specific Screen: Assets / Accounts --- */
      .asset-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--bg-card);
        padding: 20px;
        margin: 0 16px 12px 16px;
        border-radius: 16px;
        box-shadow: var(--shadow);
      }

      .asset-left {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .asset-icon {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 14px;
        font-weight: bold;
      }

      .bg-wx {
        background: #22c55e;
      }

      .bg-ali {
        background: #3b82f6;
      }

      .bg-bank {
        background: #ef4444;
      }

      .bg-cash {
        background: #f59e0b;
      }

      /* --- Specific Screen: Personal Center (MINIMALIST) --- */
      /* New Minimal Profile Layout */
      .profile-minimal {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 40px 16px 30px;
      }

      .pm-avatar {
        width: 96px;
        height: 96px;
        border-radius: 48px;
        background: var(--primary);
        /* Use primary color */
        color: var(--text-on-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 40px;
        font-weight: 700;
        margin-bottom: 16px;
        box-shadow: var(--shadow-lg);
      }

      .pm-name {
        font-size: 24px;
        font-weight: 700;
        color: var(--text-main);
        margin-bottom: 4px;
      }

      .pm-info {
        font-size: 13px;
        color: var(--text-sub);
      }

      /* Settings Groups (Unchanged) */
      .setting-group {
        background: var(--bg-card);
        margin: 0 16px 16px;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: var(--shadow);
      }

      .setting-group-title {
        padding: 16px 16px 8px;
        font-size: 12px;
        font-weight: 600;
        color: var(--text-sub);
      }

      .setting-item {
        padding: 16px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid var(--bg-app);
        font-size: 14px;
        color: var(--text-main);
        cursor: pointer;
      }

      .setting-item:last-child {
        border-bottom: none;
      }

      /* Color Picker */
      .color-options {
        display: flex;
        gap: 12px;
      }

      .color-circle {
        width: 26px;
        height: 26px;
        border-radius: 13px;
        cursor: pointer;
        border: 2px solid transparent;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition:
          transform 0.2s,
          border-color 0.2s;
      }

      .color-circle.active {
        border-color: var(--text-main);
        transform: scale(1.1);
      }

      /* --- Icons & Utilities --- */
      /* --- NEW: AI Feature Styles --- */

      /* 1. é¡¶éƒ¨ AI æ‚¬æµ®å…¥å£ (å¤´éƒ¨) */
      .ai-entry-btn {
        width: 34px;
        height: 34px;
        border-radius: 12px;
        /* AI æ ‡å¿—æ€§çš„æ¸å˜è‰² */
        background: linear-gradient(
          135deg,
          #6366f1 0%,
          #a855f7 50%,
          #ec4899 100%
        );
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        box-shadow: 0 4px 12px rgba(168, 85, 247, 0.4);
        cursor: pointer;
        position: relative;
        transition:
          transform 0.2s,
          box-shadow 0.2s;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .ai-entry-btn:active {
        transform: scale(0.92);
        box-shadow: 0 2px 6px rgba(168, 85, 247, 0.4);
      }

      /* ç®€å•çš„å‘¼å¸åŠ¨ç”»ï¼Œå¸å¼•æ³¨æ„åŠ› */
      @keyframes ai-breathe {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      /* 2. é¦–é¡µæ™ºèƒ½å»ºè®®å°å¡ç‰‡ (æ’å…¥åœ¨æ—¥å†ä¸‹æ–¹æˆ–åˆ—è¡¨ä¸­) */
      .ai-suggestion-card {
        margin: 0 16px 16px 16px;
        background: linear-gradient(
          to right,
          rgba(99, 102, 241, 0.1),
          rgba(236, 72, 153, 0.1)
        );
        border: 1px solid rgba(168, 85, 247, 0.2);
        border-radius: 12px;
        padding: 12px 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        cursor: pointer;
      }

      .ai-card-icon {
        width: 32px;
        height: 32px;
        background: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      /* æš—è‰²æ¨¡å¼é€‚é… */
      [data-theme="dark"] .ai-suggestion-card {
        background: linear-gradient(
          to right,
          rgba(99, 102, 241, 0.15),
          rgba(236, 72, 153, 0.15)
        );
        border-color: rgba(168, 85, 247, 0.3);
      }
      [data-theme="dark"] .ai-card-icon {
        background: #2c2c2e;
        color: white;
      }

      .icon {
        width: 24px;
        height: 24px;
        fill: none;
        stroke: currentColor;
        stroke-width: 2;
        stroke-linecap: round;
        stroke-linejoin: round;
      }

      .icon-sm {
        width: 16px;
        height: 16px;
        stroke-width: 2.5;
      }

      .icon-xs {
        width: 14px;
        height: 14px;
        stroke-width: 2;
      }

      .screen-label {
        position: absolute;
        top: -40px;
        left: 0;
        color: white;
        font-weight: 600;
        letter-spacing: 0.5px;
      }

      .sep-h {
        height: 1px;
        background: var(--border);
        margin: 0 24px;
      }

      .toolbar-section {
        padding: 8px 16px;
        background: var(--bg-app);
        display: flex;
        gap: 12px;
        border-bottom: 1px solid var(--border);
      }

      /* --- æ–°å¢ï¼šæ—¥å†äº¤äº’ä¸æ˜ç»†å¡ç‰‡æ ·å¼ --- */

      /* é€‰ä¸­æ—¥æœŸçš„æ ·å¼ */
      .cal-day.selected {
        border: 2px solid var(--text-main);
        /* é€‰ä¸­æ—¶æ˜¾ç¤ºæ·±è‰²è¾¹æ¡† */
        background: var(--bg-card);
        /* ä¿æŒèƒŒæ™¯ */
        transform: scale(0.95);
        /* è½»å¾®ç¼©å°äº§ç”ŸæŒ‰å‹æ„Ÿ */
        z-index: 2;
      }

      /* é€‰ä¸­ä¸”æ˜¯ä»Šå¤©çš„æ ·å¼ç‰¹ä¾‹ */
      .cal-day.is-today.selected {
        border-color: var(--text-main);
        background: var(--cal-bg-today);
      }

      /* ä¸‹æ–¹å¼¹å‡ºçš„æ˜ç»†å®¹å™¨ */
      .day-detail-container {
        margin: 0 16px 24px 16px;
        overflow: hidden;
        display: none;
        /* é»˜è®¤éšè—ï¼Œç‚¹å‡»åæ˜¾ç¤º */
        animation: slideDown 0.3s ease-out;
      }

      /* å®¹å™¨æ˜¾ç¤ºçš„ç±» */
      .day-detail-container.show {
        display: block;
      }

      /* æ˜ç»†å¡ç‰‡å¤´éƒ¨ */
      .day-card-header {
        background: var(--bg-card);
        padding: 12px 16px;
        border-radius: 16px 16px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid var(--bg-app);
      }

      /* ä¿®æ­£åˆ—è¡¨é¡¹åœ¨å¡ç‰‡å†…çš„åœ†è§’ */
      .day-list-wrapper .transaction-item:last-child {
        border-bottom-left-radius: 16px;
        border-bottom-right-radius: 16px;
      }

      .day-list-wrapper .transaction-item {
        border-radius: 0;
        /* é‡ç½®é»˜è®¤åœ†è§’ */
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* --- Stats Screen Specific Styles --- */
      .stats-header-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 16px 16px;
      }

      /* Segmented Control for Time (Week/Month/Year) */
      .segment-control {
        background: var(--pill-bg);
        border-radius: 8px;
        padding: 2px;
        display: flex;
        gap: 2px;
      }

      .segment-btn {
        padding: 4px 12px;
        font-size: 12px;
        border-radius: 6px;
        color: var(--text-sub);
        cursor: pointer;
        transition: all 0.2s;
      }

      .segment-btn.active {
        background: var(--bg-card);
        color: var(--text-main);
        font-weight: 600;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }

      /* Total Amount Display */
      .stats-total-card {
        text-align: center;
        margin-bottom: 24px;
      }

      .stats-label {
        font-size: 12px;
        color: var(--text-sub);
        margin-bottom: 4px;
      }

      .stats-amount {
        font-size: 32px;
        font-weight: 700;
        color: var(--text-main);
      }

      .stats-trend-tag {
        font-size: 12px;
        color: var(--text-sub);
        margin-top: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
      }

      .trend-up {
        color: var(--danger);
      }

      .trend-down {
        color: var(--primary);
      }

      /* SVG Line Chart Container */
      .chart-container {
        height: 180px;
        width: 100%;
        position: relative;
        margin-bottom: 32px;
      }

      .chart-svg {
        width: 100%;
        height: 100%;
        overflow: visible;
      }

      .chart-line {
        fill: none;
        stroke: var(--primary);
        stroke-width: 3;
        stroke-linecap: round;
        stroke-linejoin: round;
        transition: stroke 0.3s;
      }

      .chart-area {
        fill: url(#gradientPrimary);
        opacity: 1; /* æ”¹ä¸º 1ï¼Œè®©é€æ˜åº¦ç”±æ¸å˜æœ¬èº«æ§åˆ¶ */
        transition:
          fill 0.3s,
          opacity 0.3s;
      }

      .chart-tooltip {
        position: absolute;
        top: 10px;
        left: 50%;
        background: var(--bg-main);
        color: var(--text-main);
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        box-shadow: var(--shadow);
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.2s;
      }

      /* Donut Chart Section */
      .donut-section {
        display: flex;
        align-items: center;
        gap: 24px;
        padding: 0 16px 24px;
      }

      .donut-chart {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: conic-gradient(
          var(--primary) 0% 35%,
          var(--accent-orange) 35% 60%,
          var(--accent-blue) 60% 80%,
          var(--bg-app) 80% 100%
        );
        position: relative;
        flex-shrink: 0;
      }

      .donut-inner {
        position: absolute;
        top: 20px;
        left: 20px;
        width: 80px;
        height: 80px;
        background: var(--bg-app);
        /* Match app background to create hole */
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        color: var(--text-sub);
        flex-direction: column;
      }

      /* Dark mode fix for donut hole */
      [data-theme="dark"] .donut-inner {
        background: #000;
        /* Match body bg in dark mode usually */
      }

      /* Or better, make it match the parent container if not transparent */
      .card .donut-inner {
        background: var(--bg-card);
      }

      .legend-grid {
        flex: 1;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
        color: var(--text-sub);
      }

      .legend-dot {
        width: 8px;
        height: 8px;
        border-radius: 4px;
      }

      /* Override color for Income Mode */
      [data-mode="income"] {
        --primary: var(--accent-orange);
        /* Orange for income usually looks good or stick to green */
      }

      /* Revert standard colors logic within stats specifically if needed */
      .mode-expense .chart-line {
        stroke: var(--text-main);
      }

      /* We will control colors via JS logic updating CSS vars or classes */
    </style>
  </head>

  <body>
    <!-- TOOLBAR -->
    <div class="toolbar">
      <div style="display: flex; gap: 10px; align-items: center">
        <div
          style="
            width: 20px;
            height: 20px;
            background: var(--primary);
            border-radius: 4px;
          "
        ></div>
        <h1>small_count App Design System V4</h1>
      </div>
      <div style="display: flex; gap: 16px; align-items: center">
        <button class="btn-toggle" id="theme-toggle">
          <svg class="icon icon-xs" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="5" />
            <line x1="12" y1="1" x2="12" y2="3" />
            <line x1="12" y1="21" x2="12" y2="23" />
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
            <line x1="1" y1="12" x2="3" y2="12" />
            <line x1="21" y1="12" x2="23" y2="12" />
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
          </svg>
          Toggle Theme
        </button>
        <div class="meta">Updated Now â€¢ 5 Screens</div>
      </div>
    </div>

    <div class="canvas">
      <!-- SCREEN 1: HOME / DASHBOARD (NEW TABBED LAYOUT) -->
      <div style="position: relative">
        <div class="screen-label">01. é¦–é¡µ (Home) - Tabæ¨¡å¼</div>
        <div class="device-mockup">
          <div class="notch"></div>
          <div class="screen-content">
            <div class="dashboard-header">
              <div
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                "
              >
                <div class="date-selector" onclick="openMonthPicker()">
                  <span class="h2">2025å¹´ 11æœˆ</span>
                  <svg class="icon icon-sm" viewBox="0 0 24 24">
                    <path d="m6 9 6 6 6-6" />
                  </svg>
                </div>
                <svg
                  class="icon"
                  viewBox="0 0 24 24"
                  style="width: 20px; color: var(--text-sub)"
                >
                  <path
                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"
                  />
                </svg>
              </div>
            </div>

            <!-- NEW Internal Home Tabs -->
            <div class="home-tabs-control">
              <div class="home-tab-btn active" data-target="tab-calendar">
                æ—¥å†è§†å›¾
              </div>
              <div class="home-tab-btn" data-target="tab-details">æ˜ç»†åˆ—è¡¨</div>
            </div>

            <!-- TAB CONTENT 1: Calendar View -->
            <div class="home-tab-view active" id="tab-calendar">
              <!-- Calendar Widget -->
              <div class="calendar-widget">
                <div class="cal-header">
                  <div>æ—¥</div>
                  <div>ä¸€</div>
                  <div>äºŒ</div>
                  <div>ä¸‰</div>
                  <div>å››</div>
                  <div>äº”</div>
                  <div>å…­</div>
                </div>
                <div class="cal-grid" id="calendar-grid">
                  <!-- ä¸ºäº†æ¼”ç¤ºJSäº¤äº’ï¼Œæˆ‘ç»™éƒ¨åˆ†æ—¥æœŸåŠ äº† data-day å±æ€§ -->

                  <!-- Row 1 -->
                  <div class="cal-day not-current">
                    <span class="cal-date">26</span>
                  </div>
                  <div class="cal-day not-current">
                    <span class="cal-date">27</span>
                  </div>
                  <div class="cal-day not-current">
                    <span class="cal-date">28</span>
                  </div>
                  <div class="cal-day not-current">
                    <span class="cal-date">29</span>
                  </div>
                  <div class="cal-day not-current">
                    <span class="cal-date">30</span>
                  </div>
                  <div class="cal-day not-current">
                    <span class="cal-date">31</span>
                  </div>
                  <div class="cal-day" data-day="1">
                    <span class="cal-date">1</span>
                  </div>

                  <!-- Row 2 -->
                  <div class="cal-day" data-day="2">
                    <span class="cal-date">2</span>
                  </div>
                  <div class="cal-day" data-day="3">
                    <span class="cal-date">3</span>
                  </div>
                  <div class="cal-day" data-day="4">
                    <span class="cal-date">4</span>
                  </div>
                  <div class="cal-day" data-day="5">
                    <span class="cal-date">5</span>
                  </div>
                  <div class="cal-day" data-day="6">
                    <span class="cal-date">6</span>
                  </div>
                  <div class="cal-day" data-day="7">
                    <span class="cal-date">7</span>
                  </div>
                  <div class="cal-day" data-day="8">
                    <span class="cal-date">8</span>
                  </div>

                  <!-- Row 3 (å«æ•°æ®æ¼”ç¤º) -->
                  <div class="cal-day" data-day="9">
                    <span class="cal-date">9</span>
                  </div>
                  <div class="cal-day" data-day="10">
                    <span class="cal-date">10</span>
                  </div>
                  <div class="cal-day" data-day="11">
                    <span class="cal-date">11</span>
                  </div>

                  <!-- 12å·ï¼šåªæœ‰æ”¯å‡º -->
                  <div class="cal-day" data-day="12">
                    <span class="cal-date">12</span>
                    <div class="cal-data">
                      <span class="cal-exp">-120</span>
                    </div>
                  </div>

                  <!-- 13å·ï¼šåªæœ‰æ”¶å…¥ -->
                  <div class="cal-day" data-day="13">
                    <span class="cal-date">13</span>
                    <div class="cal-data">
                      <span class="cal-inc">+500</span>
                    </div>
                  </div>

                  <div class="cal-day" data-day="14">
                    <span class="cal-date">14</span>
                    <div class="cal-data"><span class="cal-exp">-85</span></div>
                  </div>
                  <div class="cal-day" data-day="15">
                    <span class="cal-date">15</span>
                    <div class="cal-data">
                      <span class="cal-exp">-256</span>
                    </div>
                  </div>

                  <!-- Row 4 -->
                  <div class="cal-day" data-day="16">
                    <span class="cal-date">16</span>
                  </div>
                  <div class="cal-day" data-day="17">
                    <span class="cal-date">17</span>
                    <div class="cal-data"><span class="cal-exp">-45</span></div>
                  </div>
                  <div class="cal-day" data-day="18">
                    <span class="cal-date">18</span>
                    <div class="cal-data">
                      <span class="cal-exp">-178</span>
                    </div>
                  </div>
                  <div class="cal-day" data-day="19">
                    <span class="cal-date">19</span>
                    <div class="cal-data">
                      <span class="cal-inc">+300</span>
                    </div>
                  </div>

                  <!-- Today 20å· (æ··åˆæ•°æ®) -->
                  <div class="cal-day is-today" data-day="20">
                    <span class="cal-date">20</span>
                    <div class="cal-data"><span class="cal-exp">-92</span></div>
                  </div>

                  <div class="cal-day" data-day="21">
                    <span class="cal-date">21</span>
                  </div>
                  <div class="cal-day" data-day="22">
                    <span class="cal-date">22</span>
                    <div class="cal-data">
                      <span class="cal-inc">+800</span>
                    </div>
                  </div>

                  <!-- Row 5 -->
                  <div class="cal-day" data-day="23">
                    <span class="cal-date">23</span>
                    <div class="cal-data"><span class="cal-exp">-34</span></div>
                  </div>
                  <div class="cal-day" data-day="24">
                    <span class="cal-date">24</span>
                    <div class="cal-data">
                      <span class="cal-inc">+150</span>
                    </div>
                  </div>
                  <div class="cal-day" data-day="25">
                    <span class="cal-date">25</span>
                    <div class="cal-data">
                      <span class="cal-exp">-289</span>
                    </div>
                  </div>
                  <div class="cal-day" data-day="26">
                    <span class="cal-date">26</span>
                  </div>
                  <div class="cal-day" data-day="27">
                    <span class="cal-date">27</span>
                    <div class="cal-data">
                      <span class="cal-exp">-123</span>
                    </div>
                  </div>
                  <div class="cal-day" data-day="28">
                    <span class="cal-date">28</span>
                    <div class="cal-data"><span class="cal-exp">-67</span></div>
                  </div>
                  <div class="cal-day" data-day="29">
                    <span class="cal-date">29</span>
                  </div>

                  <!-- Row 6 -->
                  <div class="cal-day not-current">
                    <span class="cal-date">30</span>
                  </div>
                  <div class="cal-day not-current">
                    <span class="cal-date">1</span>
                  </div>
                </div>
              </div>

              <!-- [NEW] Day Details Card (Dynamic) -->
              <!-- è¿™ä¸ªå®¹å™¨é»˜è®¤éšè—ï¼Œç‚¹å‡»ä¸Šé¢çš„æ—¥æœŸåï¼ŒJSä¼šå¾€è¿™é‡Œå¡«å……å†…å®¹ -->
              <div id="day-detail-wrapper" class="day-detail-container">
                <!-- Content injected by JS -->
              </div>

              <!-- Overview Card (Month Summary) -->
              <div class="overview-card">
                <div style="opacity: 0.8; font-size: 12px">æœ¬æœˆç»“ä½™ (11æœˆ)</div>
                <div style="font-size: 32px; font-weight: 700; margin-top: 4px">
                  + 1,250.00
                </div>
                <div class="ov-row">
                  <div class="ov-item">
                    <h4>æ”¶å…¥</h4>
                    <span>3,550.50</span>
                  </div>
                  <div class="ov-item" style="text-align: right">
                    <h4>æ”¯å‡º</h4>
                    <span>2,300.50</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- TAB CONTENT 2: Details View (Hidden by default) -->
            <div class="home-tab-view" id="tab-details">
              <!-- Date Group 1 -->
              <div class="date-header" style="position: sticky; top: 44px">
                <!-- Adjusted top for sticky inside tab -->
                <span>11æœˆ20æ—¥ Â· ä»Šå¤©</span>
                <span>æ”¯: 92.40</span>
              </div>
              <div style="padding: 0 16px">
                <div
                  class="transaction-item"
                  style="border-radius: 12px; border-bottom: none"
                >
                  <div class="t-icon">ğŸœ</div>
                  <div class="t-info">
                    <div style="font-weight: 500">åˆé¤</div>
                    <div style="margin-top: 4px">
                      <span class="pill">å¾®ä¿¡</span>
                    </div>
                  </div>
                  <div class="t-amount">- 92.40</div>
                </div>
              </div>

              <!-- Date Group 2 (Example Data) -->
              <div
                class="date-header"
                style="position: sticky; top: 44px; margin-top: 16px"
              >
                <span>11æœˆ19æ—¥ Â· æ˜¨å¤©</span>
                <span>æ”¶: 300.00</span>
              </div>
              <div style="padding: 0 16px">
                <div
                  class="transaction-item"
                  style="border-radius: 12px; border-bottom: none"
                >
                  <div class="t-icon">ğŸ’°</div>
                  <div class="t-info">
                    <div style="font-weight: 500">å…¼èŒæ”¶å…¥</div>
                    <div style="margin-top: 4px">
                      <span class="pill">æ”¯ä»˜å®</span>
                    </div>
                  </div>
                  <div class="t-amount money-inc">+ 300.00</div>
                </div>
              </div>

              <!-- Date Group 3 (Example Data) -->
              <div
                class="date-header"
                style="position: sticky; top: 44px; margin-top: 16px"
              >
                <span>11æœˆ18æ—¥ Â· å‘¨ä¸€</span>
                <span>æ”¯: 178.90</span>
              </div>
              <div style="padding: 0 16px">
                <div class="transaction-item">
                  <div class="t-icon">ğŸ›’</div>
                  <div class="t-info">
                    <div style="font-weight: 500">è¶…å¸‚é‡‡è´­</div>
                    <div style="margin-top: 4px">
                      <span class="pill">æ‹›å•†ä¿¡ç”¨å¡</span>
                    </div>
                  </div>
                  <div class="t-amount">- 178.90</div>
                </div>
              </div>
            </div>

            <div style="height: 20px"></div>
          </div>

          <!-- Tab Bar -->
          <div class="tab-bar">
            <div class="tab-item active">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                <polyline points="9 22 9 12 15 12 15 22" />
              </svg>
              <span>æ˜ç»†</span>
            </div>
            <div class="tab-item">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M21.21 15.89A10 10 0 1 1 8 2.83" />
                <path d="M22 12A10 10 0 0 0 12 2v10z" />
              </svg>
              <span>ç»Ÿè®¡</span>
            </div>
            <div class="fab">+</div>
            <div class="tab-item">
              <svg class="icon" viewBox="0 0 24 24">
                <rect x="2" y="5" width="20" height="14" rx="2" />
                <line x1="2" y1="10" x2="22" y2="10" />
              </svg>
              <span>è´¦æˆ·</span>
              <!-- Renamed asset -->
            </div>
            <div class="tab-item">
              <svg class="icon" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="3" />
                <path
                  d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"
                />
              </svg>
              <span>è®¾ç½®</span>
            </div>
          </div>
        </div>
      </div>

      <!-- SCREEN 2: ADD TRANSACTION (Unchanged) -->
      <div style="position: relative">
        <div class="screen-label">02. è®°è´¦ (Add)</div>
        <div class="device-mockup">
          <div class="notch"></div>
          <div class="screen-content no-tab add-screen">
            <div
              style="
                padding: 0 16px;
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              <span style="color: var(--text-sub)">å–æ¶ˆ</span>
              <div class="type-switch">
                <div class="ts-btn active">æ”¯å‡º</div>
                <div class="ts-btn">æ”¶å…¥</div>
                <div class="ts-btn">è½¬è´¦</div>
              </div>
              <span style="width: 30px"></span>
            </div>
            <div class="input-area">
              <div style="display: flex; align-items: center; gap: 8px">
                <div
                  class="cat-icon"
                  style="
                    width: 30px;
                    height: 30px;
                    background: var(--icon-bg);
                    font-size: 16px;
                  "
                >
                  ğŸœ
                </div>
                <span class="input-label">é¤é¥®ç¾é£Ÿ - å¾®ä¿¡é›¶é’±</span>
              </div>
              <div class="amount-display">Â¥ 38.00</div>
            </div>
            <div class="sep-h"></div>
            <div
              style="
                padding: 16px 24px;
                font-size: 12px;
                color: var(--text-sub);
              "
            >
              é€‰æ‹©åˆ†ç±»
            </div>
            <div class="category-grid">
              <div class="cat-item selected">
                <div class="cat-icon">ğŸœ</div>
                <span class="cat-name">é¤é¥®</span>
              </div>
              <div class="cat-item">
                <div class="cat-icon">ğŸšŒ</div>
                <span class="cat-name">äº¤é€š</span>
              </div>
              <div class="cat-item">
                <div class="cat-icon">ğŸ›’</div>
                <span class="cat-name">è´­ç‰©</span>
              </div>
              <div class="cat-item">
                <div class="cat-icon">ğŸ </div>
                <span class="cat-name">å±…ä½</span>
              </div>
              <div class="cat-item">
                <div class="cat-icon">ğŸ®</div>
                <span class="cat-name">å¨±ä¹</span>
              </div>
              <div class="cat-item">
                <div class="cat-icon">ğŸ¥</div>
                <span class="cat-name">åŒ»ç–—</span>
              </div>
              <div class="cat-item">
                <div class="cat-icon">ğŸ“š</div>
                <span class="cat-name">å­¦ä¹ </span>
              </div>
              <div class="cat-item">
                <div class="cat-icon">âœˆï¸</div>
                <span class="cat-name">æ—…è¡Œ</span>
              </div>
              <div class="cat-item">
                <div class="cat-icon">ğŸ</div>
                <span class="cat-name">äººæƒ…</span>
              </div>
              <div class="cat-item">
                <div class="cat-icon">âš™ï¸</div>
                <span class="cat-name">å…¶ä»–</span>
              </div>
            </div>
            <div class="toolbar-section">
              <span class="pill" style="background: var(--bg-card)"
                >ğŸ“… 11æœˆ20æ—¥</span
              >
              <span class="pill" style="background: var(--bg-card)"
                >ğŸ“ æ·»åŠ å¤‡æ³¨...</span
              >
              <span class="pill" style="background: var(--bg-card)"
                >ğŸ“· ç¥¨æ®</span
              >
            </div>
            <div class="num-pad">
              <div class="num-keys">
                <div class="key">7</div>
                <div class="key">8</div>
                <div class="key">9</div>
                <div class="key">4</div>
                <div class="key">5</div>
                <div class="key">6</div>
                <div class="key">1</div>
                <div class="key">2</div>
                <div class="key">3</div>
                <div class="key">.</div>
                <div class="key">0</div>
                <div class="key">âŒ«</div>
              </div>
              <div class="action-keys">
                <div
                  class="key"
                  style="background: var(--key-bg-special); font-size: 14px"
                >
                  è´¦æˆ·
                </div>
                <div class="key-done">å®Œæˆ</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- SCREEN 3: ACCOUNTS (Renamed from Assets) -->
      <div style="position: relative">
        <div class="screen-label">03. å¤šè´¦æˆ· (Accounts) - å·²æ›´å</div>
        <div class="device-mockup">
          <div class="notch"></div>
          <div class="screen-content">
            <div class="dashboard-header">
              <div class="h1">å¤šè´¦æˆ·ç®¡ç†</div>
              <div
                style="
                  font-size: 28px;
                  font-weight: 700;
                  margin-top: 4px;
                  color: var(--text-main);
                "
              >
                85,240.50
              </div>
            </div>
            <div style="padding: 0 16px; margin-bottom: 16px">
              <span class="text-sm">è´Ÿå€º: 12,000.00</span>
            </div>
            <div class="asset-item">
              <div class="asset-left">
                <div class="asset-icon bg-cash">Â¥</div>
                <div>
                  <div class="text-md font-bold">ç°é‡‘é’±åŒ…</div>
                  <div class="text-sm">æ— éœ€è®°å</div>
                </div>
              </div>
              <div class="text-md font-bold">450.00</div>
            </div>
            <div class="asset-item">
              <div class="asset-left">
                <div class="asset-icon bg-wx">å¾®</div>
                <div>
                  <div class="text-md font-bold">å¾®ä¿¡é›¶é’±</div>
                  <div class="text-sm">æ—¥å¸¸å¼€é”€</div>
                </div>
              </div>
              <div class="text-md font-bold">2,300.50</div>
            </div>
            <div class="asset-item">
              <div class="asset-left">
                <div class="asset-icon bg-ali">æ”¯</div>
                <div>
                  <div class="text-md font-bold">æ”¯ä»˜å®</div>
                  <div class="text-sm">ç†è´¢é€š</div>
                </div>
              </div>
              <div class="text-md font-bold">50,200.00</div>
            </div>
            <div class="asset-item">
              <div class="asset-left">
                <div class="asset-icon bg-bank">æ‹›</div>
                <div>
                  <div class="text-md font-bold">æ‹›å•†ä¿¡ç”¨å¡</div>
                  <div class="text-sm">è´¦å•æ—¥ 15å·</div>
                </div>
              </div>
              <div class="text-md font-bold" style="color: var(--danger)">
                - 8,450.00
              </div>
            </div>

            <!-- Add Account Button (Visual) -->
            <div
              class="asset-item"
              style="
                border: 2px dashed var(--border);
                justify-content: center;
                color: var(--primary);
                background: transparent;
                box-shadow: none;
                font-weight: 600;
                cursor: pointer;
              "
            >
              + æ·»åŠ æ–°è´¦æˆ·
            </div>
          </div>
          <div class="tab-bar">
            <div class="tab-item">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /></svg
              ><span>æ˜ç»†</span>
            </div>
            <div class="tab-item">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M21.21 15.89A10 10 0 1 1 8 2.83" /></svg
              ><span>ç»Ÿè®¡</span>
            </div>
            <div class="fab">+</div>
            <div class="tab-item active">
              <svg class="icon" viewBox="0 0 24 24">
                <rect x="2" y="5" width="20" height="14" rx="2" />
                <line x1="2" y1="10" x2="22" y2="10" /></svg
              ><span>è´¦æˆ·</span>
            </div>
            <div class="tab-item">
              <svg class="icon" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="3" /></svg
              ><span>è®¾ç½®</span>
            </div>
          </div>
        </div>
      </div>

      <!-- SCREEN 4: STATS (Redesigned) -->
      <div style="position: relative">
        <div class="screen-label">04. ç»Ÿè®¡ (Stats) - å¤šå›¾è¡¨ç‰ˆ</div>
        <div class="device-mockup">
          <div class="notch"></div>
          <div class="screen-content" id="stats-screen">
            <!-- Header: Period & Type Switcher -->
            <div class="dashboard-header" style="padding-bottom: 0">
              <div class="stats-header-row" style="padding: 0 0 16px 0">
                <div class="segment-control">
                  <div
                    class="segment-btn"
                    onclick="switchStatsPeriod(this, 'week')"
                  >
                    å‘¨
                  </div>
                  <div
                    class="segment-btn active"
                    onclick="switchStatsPeriod(this, 'month')"
                  >
                    æœˆ
                  </div>
                  <div
                    class="segment-btn"
                    onclick="switchStatsPeriod(this, 'year')"
                  >
                    å¹´
                  </div>
                </div>

                <div class="type-switch" style="padding: 0; margin: 0">
                  <!-- JS will toggle 'active' class -->
                  <div
                    class="ts-btn active"
                    id="btn-stats-exp"
                    onclick="toggleStatsType('expense')"
                    style="padding: 4px 12px; font-size: 12px"
                  >
                    æ”¯å‡º
                  </div>
                  <div
                    class="ts-btn"
                    id="btn-stats-inc"
                    onclick="toggleStatsType('income')"
                    style="padding: 4px 12px; font-size: 12px"
                  >
                    æ”¶å…¥
                  </div>
                </div>
              </div>
            </div>

            <!-- Total Summary -->
            <div class="stats-total-card">
              <div class="stats-label">11æœˆ æ€»æ”¯å‡º</div>
              <div class="stats-amount" id="stats-total-amount">Â¥ 5,823.40</div>
              <div class="stats-trend-tag">
                <span class="trend-up">â–² 12%</span>
                <span>å¯¹æ¯”ä¸Šæœˆ</span>
              </div>
            </div>

            <!-- Chart 1: Trend (Line/Area) -->
            <div class="card" style="padding: 20px 0 0 0; overflow: hidden">
              <div
                style="
                  padding: 0 20px;
                  font-weight: 600;
                  font-size: 14px;
                  margin-bottom: 10px;
                "
              >
                æ¯æ—¥è¶‹åŠ¿
              </div>
              <div class="chart-container">
                <svg
                  class="chart-svg"
                  viewBox="0 0 300 100"
                  preserveAspectRatio="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <defs>
                    <!-- æ”¯å‡ºæ¸å˜ (Green/Primary) -->
                    <linearGradient
                      id="gradientPrimary"
                      x1="0"
                      x2="0"
                      y1="0"
                      y2="1"
                    >
                      <!-- ä½¿ç”¨ style å†™æ³•å…¼å®¹ CSS å˜é‡ -->
                      <stop
                        offset="0%"
                        style="stop-color: var(--primary); stop-opacity: 0.4"
                      />
                      <stop
                        offset="100%"
                        style="stop-color: var(--primary); stop-opacity: 0"
                      />
                    </linearGradient>

                    <!-- æ”¶å…¥æ¸å˜ (Orange) - ç¡®ä¿æ­¤ ID å­˜åœ¨ï¼ŒJS åˆ‡æ¢æ—¶ä¼šç”¨åˆ° -->
                    <linearGradient
                      id="gradientOrange"
                      x1="0"
                      x2="0"
                      y1="0"
                      y2="1"
                    >
                      <stop
                        offset="0%"
                        style="
                          stop-color: var(--accent-orange);
                          stop-opacity: 0.4;
                        "
                      />
                      <stop
                        offset="100%"
                        style="
                          stop-color: var(--accent-orange);
                          stop-opacity: 0;
                        "
                      />
                    </linearGradient>
                  </defs>

                  <!-- åŒºåŸŸå¡«å……å±‚ -->
                  <path
                    id="trend-area"
                    class="chart-area"
                    d="M0,80 Q30,70 60,40 T120,50 T180,30 T240,60 T300,40 V100 H0 Z"
                    style="fill: url(#gradientPrimary); opacity: 0.2"
                  />

                  <!-- çº¿æ¡å±‚ -->
                  <path
                    id="trend-line"
                    class="chart-line"
                    d="M0,80 Q30,70 60,40 T120,50 T180,30 T240,60 T300,40"
                    style="stroke: var(--primary); stroke-width: 2; fill: none"
                  />
                </svg>

                <!-- Xè½´åæ ‡ - ä¿®æ”¹ä¸ºå¯åŠ¨æ€æ›´æ–° -->
                <div
                  class="x-axis"
                  style="
                    display: flex;
                    justify-content: space-between;
                    padding: 0 16px;
                    margin-top: -20px;
                    position: relative;
                    font-size: 10px;
                    color: var(--text-sub);
                  "
                >
                  <span>1æ—¥</span>
                  <span>7æ—¥</span>
                  <span>14æ—¥</span>
                  <span>21æ—¥</span>
                  <span>28æ—¥</span>
                </div>
              </div>
            </div>

            <!-- Chart 2: Structure (Donut) -->
            <div class="card">
              <div
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 16px;
                "
              >
                <span style="font-weight: 600; font-size: 14px">åˆ†ç±»æ„æˆ</span>
                <span class="text-sm" style="color: var(--primary)"
                  >æŸ¥çœ‹å…¨éƒ¨ ></span
                >
              </div>

              <div class="donut-section">
                <div class="donut-chart" id="category-donut">
                  <div class="donut-inner">
                    <span
                      style="
                        font-size: 16px;
                        font-weight: 700;
                        color: var(--text-main);
                      "
                      >Top 5</span
                    >
                    <span>ç±»åˆ«</span>
                  </div>
                </div>
                <div class="legend-grid">
                  <div class="legend-item">
                    <div
                      class="legend-dot"
                      style="background: var(--text-main)"
                    ></div>
                    <span>æˆ¿ç§Ÿ 35%</span>
                  </div>
                  <div class="legend-item">
                    <div
                      class="legend-dot"
                      style="background: var(--primary)"
                    ></div>
                    <span>é¤é¥® 20%</span>
                  </div>
                  <div class="legend-item">
                    <div
                      class="legend-dot"
                      style="background: var(--accent-orange)"
                    ></div>
                    <span>è´­ç‰© 15%</span>
                  </div>
                  <div class="legend-item">
                    <div
                      class="legend-dot"
                      style="background: var(--accent-blue)"
                    ></div>
                    <span>äº¤é€š 10%</span>
                  </div>
                  <div class="legend-item">
                    <div
                      class="legend-dot"
                      style="background: var(--border)"
                    ></div>
                    <span>å…¶ä»– 20%</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- List: Ranking (Maps to Transactions grouped by Tag) -->
            <div
              style="
                padding: 0 20px;
                font-size: 14px;
                font-weight: 600;
                margin-bottom: 10px;
                color: var(--text-sub);
              "
            >
              æ”¯å‡ºæ’è¡Œæ¦œ (Top Spending)
            </div>

            <div id="stats-ranking-list">
              <!-- Item 1 -->
              <div
                class="transaction-item"
                style="
                  margin: 0 16px 1px 16px;
                  border-radius: 12px 12px 0 0;
                  border-bottom: 1px solid var(--border);
                "
              >
                <div class="t-icon">ğŸ </div>
                <div class="t-info">
                  <div
                    style="
                      display: flex;
                      justify-content: space-between;
                      margin-bottom: 6px;
                    "
                  >
                    <span style="font-weight: 500">æˆ¿ç§Ÿæˆ¿è´·</span>
                    <span style="font-weight: 600">35%</span>
                  </div>
                  <div
                    style="
                      width: 100%;
                      height: 6px;
                      background: var(--bg-app);
                      border-radius: 3px;
                    "
                  >
                    <div
                      style="
                        width: 35%;
                        height: 100%;
                        background: var(--text-main);
                        border-radius: 3px;
                      "
                    ></div>
                  </div>
                </div>
                <div
                  class="t-amount"
                  style="margin-left: 12px; font-size: 15px"
                >
                  3,500
                </div>
              </div>

              <!-- Item 2 -->
              <div
                class="transaction-item"
                style="
                  margin: 0 16px 1px 16px;
                  border-radius: 0;
                  border-bottom: 1px solid var(--border);
                "
              >
                <div class="t-icon">ğŸœ</div>
                <div class="t-info">
                  <div
                    style="
                      display: flex;
                      justify-content: space-between;
                      margin-bottom: 6px;
                    "
                  >
                    <span style="font-weight: 500">é¤é¥®ç¾é£Ÿ</span>
                    <span style="font-weight: 600">20%</span>
                  </div>
                  <div
                    style="
                      width: 100%;
                      height: 6px;
                      background: var(--bg-app);
                      border-radius: 3px;
                    "
                  >
                    <div
                      style="
                        width: 20%;
                        height: 100%;
                        background: var(--primary);
                        border-radius: 3px;
                      "
                    ></div>
                  </div>
                </div>
                <div
                  class="t-amount"
                  style="margin-left: 12px; font-size: 15px"
                >
                  2,000
                </div>
              </div>

              <!-- Item 3 -->
              <div
                class="transaction-item"
                style="margin: 0 16px 1px 16px; border-radius: 0 0 12px 12px"
              >
                <div class="t-icon">ğŸ›’</div>
                <div class="t-info">
                  <div
                    style="
                      display: flex;
                      justify-content: space-between;
                      margin-bottom: 6px;
                    "
                  >
                    <span style="font-weight: 500">è´­ç‰©æ¶ˆè´¹</span>
                    <span style="font-weight: 600">15%</span>
                  </div>
                  <div
                    style="
                      width: 100%;
                      height: 6px;
                      background: var(--bg-app);
                      border-radius: 3px;
                    "
                  >
                    <div
                      style="
                        width: 15%;
                        height: 100%;
                        background: var(--accent-orange);
                        border-radius: 3px;
                      "
                    ></div>
                  </div>
                </div>
                <div
                  class="t-amount"
                  style="margin-left: 12px; font-size: 15px"
                >
                  1,500
                </div>
              </div>
            </div>

            <div style="height: 20px"></div>
          </div>
          <div class="tab-bar">
            <div class="tab-item">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /></svg
              ><span>æ˜ç»†</span>
            </div>
            <div class="tab-item active">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M21.21 15.89A10 10 0 1 1 8 2.83" /></svg
              ><span>ç»Ÿè®¡</span>
            </div>
            <div class="fab">+</div>
            <div class="tab-item">
              <svg class="icon" viewBox="0 0 24 24">
                <rect x="2" y="5" width="20" height="14" rx="2" /></svg
              ><span>è´¦æˆ·</span>
            </div>
            <div class="tab-item">
              <svg class="icon" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="3" /></svg
              ><span>è®¾ç½®</span>
            </div>
          </div>
        </div>
      </div>

      <!-- SCREEN 5: PERSONAL CENTER (MINIMALIST) -->
      <div style="position: relative">
        <div class="screen-label">05. ä¸ªäººä¸­å¿ƒ (Settings) - æç®€ç‰ˆ</div>
        <div class="device-mockup">
          <div class="notch"></div>
          <div class="screen-content">
            <div class="dashboard-header">
              <div class="h1">ä¸ªäººä¸­å¿ƒ</div>
            </div>

            <!-- Minimal Profile Layout -->
            <div class="profile-minimal">
              <div class="pm-avatar">M</div>
              <div class="pm-name">small_countè®°è´¦ç”¨æˆ·</div>
              <div class="pm-info">small_count v2.2.0</div>
            </div>

            <!-- Settings Group 1: Appearance -->
            <div class="setting-group-title" style="margin-left: 16px">
              å¤–è§‚è®¾ç½®
            </div>
            <div class="setting-group">
              <div class="setting-item">
                <span>ä¸»é¢˜è‰²</span>
                <div class="color-options">
                  <div
                    class="color-circle active"
                    style="background: var(--accent-green)"
                    data-color="green"
                  ></div>
                  <div
                    class="color-circle"
                    style="background: var(--accent-blue)"
                    data-color="blue"
                  ></div>
                  <div
                    class="color-circle"
                    style="background: var(--accent-purple)"
                    data-color="purple"
                  ></div>
                  <div
                    class="color-circle"
                    style="background: var(--accent-orange)"
                    data-color="orange"
                  ></div>
                </div>
              </div>
              <div class="setting-item" id="settings-theme-toggle">
                <span>æ·±è‰²æ¨¡å¼</span>
                <div style="pointer-events: none">
                  <!-- Fake Switch UI -->
                  <div
                    style="
                      width: 44px;
                      height: 24px;
                      background: var(--pill-bg);
                      border-radius: 12px;
                      position: relative;
                      transition: background 0.3s;
                    "
                  >
                    <div
                      class="switch-knob"
                      style="
                        width: 20px;
                        height: 20px;
                        background: white;
                        border-radius: 10px;
                        position: absolute;
                        top: 2px;
                        left: 2px;
                        transition: left 0.3s;
                        box-shadow: var(--shadow);
                      "
                    ></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Settings Group 2: General -->
            <div class="setting-group-title" style="margin-left: 16px">
              é€šç”¨è®¾ç½®
            </div>
            <div class="setting-group">
              <div class="setting-item">
                <span>å¤šè´¦æœ¬ç®¡ç†</span
                ><svg
                  class="icon icon-sm"
                  style="color: var(--text-sub)"
                  viewBox="0 0 24 24"
                >
                  <polyline points="9 18 15 12 9 6" />
                </svg>
              </div>
              <div class="setting-item">
                <span>æ•°æ®å®‰å…¨ä¸å¤‡ä»½</span
                ><svg
                  class="icon icon-sm"
                  style="color: var(--text-sub)"
                  viewBox="0 0 24 24"
                >
                  <polyline points="9 18 15 12 9 6" />
                </svg>
              </div>
              <div class="setting-item">
                <span>åˆ†ç±»ç®¡ç†</span
                ><svg
                  class="icon icon-sm"
                  style="color: var(--text-sub)"
                  viewBox="0 0 24 24"
                >
                  <polyline points="9 18 15 12 9 6" />
                </svg>
              </div>
            </div>
          </div>
          <!-- Tab Bar (Settings Active) -->
          <div class="tab-bar">
            <div class="tab-item">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /></svg
              ><span>æ˜ç»†</span>
            </div>
            <div class="tab-item">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M21.21 15.89A10 10 0 1 1 8 2.83" /></svg
              ><span>ç»Ÿè®¡</span>
            </div>
            <div class="fab">+</div>
            <div class="tab-item">
              <svg class="icon" viewBox="0 0 24 24">
                <rect x="2" y="5" width="20" height="14" rx="2" /></svg
              ><span>è´¦æˆ·</span>
            </div>
            <div class="tab-item active">
              <svg class="icon" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="3" />
                <path
                  d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"
                /></svg
              ><span>è®¾ç½®</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // 1. Keypad Interaction
      document.querySelectorAll(".key").forEach((key) => {
        key.addEventListener("click", () => {
          const display = document.querySelector(".amount-display");
          const text = key.innerText;
          if (text === "âŒ«" || text === "è´¦æˆ·") return;
          if (display.innerText === "Â¥ 38.00") display.innerText = "Â¥ ";
          display.innerText += text;
        });
      });

      // 2. Theme Toggle Logic
      const htmlTag = document.documentElement;
      const toggleThemeFn = () => {
        const currentTheme = htmlTag.getAttribute("data-theme");
        const newTheme = currentTheme === "light" ? "dark" : "light";
        htmlTag.setAttribute("data-theme", newTheme);

        // Update fake switch UI in settings
        const knob = document.querySelector(".switch-knob");
        const switchBg = knob.parentElement;
        if (newTheme === "dark") {
          knob.style.left = "22px";
          switchBg.style.background = "var(--primary)";
        } else {
          knob.style.left = "2px";
          switchBg.style.background = "var(--pill-bg)";
        }
      };
      document
        .getElementById("theme-toggle")
        .addEventListener("click", toggleThemeFn);
      document
        .getElementById("settings-theme-toggle")
        .addEventListener("click", toggleThemeFn);

      // 3. Accent Color Switcher Logic
      const colorCircles = document.querySelectorAll(".color-circle");
      colorCircles.forEach((circle) => {
        circle.addEventListener("click", (e) => {
          colorCircles.forEach((c) => c.classList.remove("active"));
          e.target.classList.add("active");
          const colorName = e.target.getAttribute("data-color");
          const newColorVar = `var(--accent-${colorName})`;
          document.documentElement.style.setProperty("--primary", newColorVar);

          const currentTheme = htmlTag.getAttribute("data-theme");
          if (currentTheme === "dark") {
            document.querySelector(
              ".switch-knob"
            ).parentElement.style.background = newColorVar;
          }
        });
      });

      // 4. NEW: Home Tab Switching Logic
      const homeTabBtns = document.querySelectorAll(".home-tab-btn");
      const homeTabViews = document.querySelectorAll(".home-tab-view");

      homeTabBtns.forEach((btn) => {
        btn.addEventListener("click", (e) => {
          // Deactivate all buttons and views
          homeTabBtns.forEach((b) => b.classList.remove("active"));
          homeTabViews.forEach((v) => v.classList.remove("active"));

          // Activate clicked button
          const targetId = e.target.getAttribute("data-target");
          e.target.classList.add("active");

          // Activate corresponding view
          document.getElementById(targetId).classList.add("active");
        });
      });

      console.log("small_count App UI V4 Loaded: Home Tabs & Minimal Profile.");

      // ... (ä¹‹å‰çš„ä»£ç )

      // 5. NEW: Calendar Day Click Interaction
      const dayDetailWrapper = document.getElementById("day-detail-wrapper");
      const calGrid = document.getElementById("calendar-grid");
      const calDays = calGrid.querySelectorAll(".cal-day:not(.not-current)");

      // æ¨¡æ‹Ÿæ•°æ®æºï¼šæ—¥æœŸ -> äº¤æ˜“åˆ—è¡¨
      const mockTransactions = {
        12: [
          {
            icon: "ğŸ›’",
            name: "è¶…å¸‚é‡‡è´­",
            pay: "å¾®ä¿¡",
            amount: "- 120.00",
            type: "exp",
          },
        ],
        13: [
          {
            icon: "ğŸ’°",
            name: "é€€æ¬¾åˆ°è´¦",
            pay: "æ”¯ä»˜å®",
            amount: "+ 500.00",
            type: "inc",
          },
        ],
        20: [
          // Today
          {
            icon: "ğŸœ",
            name: "åˆé¤",
            pay: "å¾®ä¿¡é›¶é’±",
            amount: "- 58.00",
            type: "exp",
          },
          {
            icon: "â˜•",
            name: "å’–å•¡",
            pay: "æ˜Ÿå·´å…‹å¡",
            amount: "- 34.40",
            type: "exp",
          },
        ],
        22: [
          {
            icon: "ğŸ’µ",
            name: "å¥–é‡‘å‘æ”¾",
            pay: "æ‹›å•†é“¶è¡Œ",
            amount: "+ 800.00",
            type: "inc",
          },
        ],
        18: [
          {
            icon: "ğŸ›’",
            name: "ä¾¿åˆ©åº—",
            pay: "ç°é‡‘",
            amount: "- 28.90",
            type: "exp",
          },
          {
            icon: "ğŸ®",
            name: "Steamæ¸¸æˆ",
            pay: "ä¿¡ç”¨å¡",
            amount: "- 150.00",
            type: "exp",
          },
        ],
      };

      calDays.forEach((day) => {
        day.addEventListener("click", function () {
          // 1. ç§»é™¤å…¶ä»–æ—¥æœŸçš„é€‰ä¸­çŠ¶æ€
          calDays.forEach((d) => d.classList.remove("selected"));

          // 2. é€‰ä¸­å½“å‰æ—¥æœŸ
          this.classList.add("selected");

          // 3. è·å–æ—¥æœŸæ•°æ®
          const dateNum = this.getAttribute("data-day");
          const data = mockTransactions[dateNum];

          // 4. ç”Ÿæˆå¹¶æ¸²æŸ“æ˜ç»†å¡ç‰‡
          renderDayDetails(dateNum, data);
        });
      });

      function renderDayDetails(date, list) {
        // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œå¯ä»¥é€‰æ‹©éšè—å®¹å™¨æˆ–è€…æ˜¾ç¤ºæ— æ•°æ®æç¤º
        if (!list || list.length === 0) {
          // ç®€å•å¤„ç†ï¼šå¦‚æœæ²¡æœ‰æ•°æ®ï¼Œæ˜¾ç¤ºä¸€ä¸ªç©ºçš„æç¤ºæˆ–è€…éšè—
          dayDetailWrapper.innerHTML = `
                    <div class="card" style="text-align:center; padding:24px; color:var(--text-sub);">
                        <div style="font-size:12px;">11æœˆ${date}æ—¥ Â· æ— è®°è´¦è®°å½•</div>
                    </div>
                `;
          dayDetailWrapper.classList.add("show");
          return;
        }

        // è®¡ç®—å½“æ—¥ç»Ÿè®¡
        let totalExp = 0;
        let totalInc = 0;
        list.forEach((item) => {
          const val = parseFloat(item.amount.replace(/[^0-9.]/g, ""));
          if (item.type === "exp") totalExp += val;
          else totalInc += val;
        });

        // ç”Ÿæˆåˆ—è¡¨ HTML
        const listHtml = list
          .map(
            (item) => `
                <div class="transaction-item">
                    <div class="t-icon">${item.icon}</div>
                    <div class="t-info">
                        <div style="font-weight:500;">${item.name}</div>
                        <div style="margin-top:4px;"><span class="pill">${item.pay}</span></div>
                    </div>
                    <div class="t-amount ${item.type === "inc" ? "money-inc" : ""}">${item.amount}</div>
                </div>
            `
          )
          .join("");

        // ç»„è£…å®Œæ•´å¡ç‰‡
        const headerHtml = `
                <div class="day-card-header">
                    <div style="font-weight:600; color:var(--text-main);">11æœˆ${date}æ—¥</div>
                    <div style="font-size:12px; color:var(--text-sub);">
                        ${totalInc > 0 ? `<span class="money-inc">æ”¶ +${totalInc.toFixed(2)}</span> &nbsp;` : ""}
                        ${totalExp > 0 ? `<span>æ”¯ -${totalExp.toFixed(2)}</span>` : ""}
                    </div>
                </div>
            `;

        dayDetailWrapper.innerHTML = `
                <div style="box-shadow:var(--shadow); border-radius:16px;">
                    ${headerHtml}
                    <div class="day-list-wrapper" style="background:var(--bg-card);">
                        ${listHtml}
                    </div>
                </div>
            `;

        dayDetailWrapper.classList.add("show");
      }

      console.log("small_count App: Calendar Interaction Loaded.");

      // 6. NEW: Month Picker Functionality
      // åˆ›å»ºæœˆä»½é€‰æ‹©å™¨æ¨¡æ€æ¡†
      function createMonthPickerModal() {
        const modal = document.createElement("div");
        modal.id = "month-picker-modal";
        modal.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.5);
          display: flex;
          justify-content: center;
          align-items: flex-end;
          z-index: 1000;
          opacity: 0;
          visibility: hidden;
          transition: opacity 0.3s, visibility 0.3s;
        `;

        const content = document.createElement("div");
        content.style.cssText = `
          background-color: var(--bg-modal);
          width: 100%;
          max-width: var(--screen-w);
          border-top-left-radius: 20px;
          border-top-right-radius: 20px;
          padding: 24px;
          transform: translateY(100%);
          transition: transform 0.3s;
        `;

        // æ¨¡æ€æ¡†å¤´éƒ¨
        const header = document.createElement("div");
        header.style.cssText = `
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 24px;
        `;

        const cancelBtn = document.createElement("button");
        cancelBtn.textContent = "å–æ¶ˆ";
        cancelBtn.style.cssText = `
          background: none;
          border: none;
          color: var(--text-sub);
          font-size: 16px;
          padding: 8px 16px;
        `;
        cancelBtn.addEventListener("click", closeMonthPicker);

        const title = document.createElement("h3");
        title.textContent = "é€‰æ‹©æœˆä»½";
        title.style.cssText = `
          margin: 0;
          font-size: 18px;
          font-weight: 600;
          color: var(--text-main);
        `;

        const confirmBtn = document.createElement("button");
        confirmBtn.textContent = "ç¡®å®š";
        confirmBtn.style.cssText = `
          background: none;
          border: none;
          color: var(--primary);
          font-size: 16px;
          font-weight: 600;
          padding: 8px 16px;
        `;
        confirmBtn.addEventListener("click", () => {
          if (selectedMonth && selectedYear) {
            updateSelectedMonth(selectedYear, selectedMonth);
            closeMonthPicker();
          }
        });

        header.appendChild(cancelBtn);
        header.appendChild(title);
        header.appendChild(confirmBtn);

        // å¹´ä»½é€‰æ‹©å™¨
        const yearSelector = document.createElement("div");
        yearSelector.style.cssText = `
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 24px;
        `;

        const prevYearBtn = document.createElement("button");
        prevYearBtn.innerHTML =
          '<svg class="icon" viewBox="0 0 24 24"><path d="M15 6l-6 6 6 6"/></svg>';
        prevYearBtn.style.cssText = `
          background: none;
          border: none;
          color: var(--text-main);
          padding: 8px;
        `;

        const yearDisplay = document.createElement("span");
        yearDisplay.id = "year-display";
        yearDisplay.textContent = "2025å¹´";
        yearDisplay.style.cssText = `
          font-size: 18px;
          font-weight: 600;
          color: var(--text-main);
        `;

        const nextYearBtn = document.createElement("button");
        nextYearBtn.innerHTML =
          '<svg class="icon" viewBox="0 0 24 24"><path d="M9 6l6 6-6 6"/></svg>';
        nextYearBtn.style.cssText = `
          background: none;
          border: none;
          color: var(--text-main);
          padding: 8px;
        `;

        yearSelector.appendChild(prevYearBtn);
        yearSelector.appendChild(yearDisplay);
        yearSelector.appendChild(nextYearBtn);

        // æœˆä»½ç½‘æ ¼
        const monthGrid = document.createElement("div");
        monthGrid.id = "month-grid";
        monthGrid.style.cssText = `
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 12px;
        `;

        const months = [
          "1æœˆ",
          "2æœˆ",
          "3æœˆ",
          "4æœˆ",
          "5æœˆ",
          "6æœˆ",
          "7æœˆ",
          "8æœˆ",
          "9æœˆ",
          "10æœˆ",
          "11æœˆ",
          "12æœˆ",
        ];
        months.forEach((month, index) => {
          const monthBtn = document.createElement("button");
          monthBtn.textContent = month;
          monthBtn.dataset.month = (index + 1).toString();
          monthBtn.style.cssText = `
            background-color: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px;
            font-size: 16px;
            color: var(--text-main);
            transition: all 0.2s;
          `;

          // é»˜è®¤é€‰ä¸­11æœˆ
          if (index === 10) {
            monthBtn.style.backgroundColor = "var(--primary)";
            monthBtn.style.color = "var(--text-on-primary)";
            monthBtn.style.borderColor = "var(--primary)";
          }

          monthBtn.addEventListener("click", function () {
            // ç§»é™¤å…¶ä»–æœˆä»½çš„é€‰ä¸­çŠ¶æ€
            monthGrid.querySelectorAll("button").forEach((btn) => {
              btn.style.backgroundColor = "var(--bg-card)";
              btn.style.color = "var(--text-main)";
              btn.style.borderColor = "var(--border)";
            });

            // é€‰ä¸­å½“å‰æœˆä»½
            this.style.backgroundColor = "var(--primary)";
            this.style.color = "var(--text-on-primary)";
            this.style.borderColor = "var(--primary)";

            // æ›´æ–°é€‰ä¸­çš„æœˆä»½
            selectedMonth = parseInt(this.dataset.month);
          });

          monthGrid.appendChild(monthBtn);
        });

        content.appendChild(header);
        content.appendChild(yearSelector);
        content.appendChild(monthGrid);
        modal.appendChild(content);
        document.body.appendChild(modal);

        // å¹´ä»½åˆ‡æ¢äº‹ä»¶
        let currentDisplayYear = 2025;
        selectedYear = 2025;
        selectedMonth = 11;

        prevYearBtn.addEventListener("click", () => {
          currentDisplayYear--;
          yearDisplay.textContent = currentDisplayYear + "å¹´";
          selectedYear = currentDisplayYear;
        });

        nextYearBtn.addEventListener("click", () => {
          currentDisplayYear++;
          yearDisplay.textContent = currentDisplayYear + "å¹´";
          selectedYear = currentDisplayYear;
        });

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        modal.addEventListener("click", function (e) {
          if (e.target === this) {
            closeMonthPicker();
          }
        });
      }

      let selectedYear, selectedMonth;

      // æ‰“å¼€æœˆä»½é€‰æ‹©å™¨
      function openMonthPicker() {
        // å¦‚æœæ¨¡æ€æ¡†ä¸å­˜åœ¨ï¼Œåˆ›å»ºå®ƒ
        if (!document.getElementById("month-picker-modal")) {
          createMonthPickerModal();
        }

        const modal = document.getElementById("month-picker-modal");
        const content = modal.querySelector("div");

        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        modal.style.opacity = "1";
        modal.style.visibility = "visible";
        content.style.transform = "translateY(0)";
      }

      // å…³é—­æœˆä»½é€‰æ‹©å™¨
      function closeMonthPicker() {
        const modal = document.getElementById("month-picker-modal");
        const content = modal.querySelector("div");

        // éšè—æ¨¡æ€æ¡†
        modal.style.opacity = "0";
        modal.style.visibility = "hidden";
        content.style.transform = "translateY(100%)";
      }

      // æ›´æ–°é€‰ä¸­çš„æœˆä»½
      function updateSelectedMonth(year, month) {
        // æ›´æ–°æ—¥æœŸé€‰æ‹©å™¨æ˜¾ç¤ºçš„æœˆä»½
        const dateSelectorText = document.querySelector(".date-selector .h2");
        dateSelectorText.textContent = `${year}å¹´ ${month}æœˆ`;

        // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´æ–°æ—¥å†å†…å®¹çš„é€»è¾‘
        console.log(`å·²é€‰æ‹©æœˆä»½: ${year}å¹´${month}æœˆ`);

        // TODO: æ ¹æ®é€‰æ‹©çš„æœˆä»½æ›´æ–°æ—¥å†ç½‘æ ¼å†…å®¹
      }

      console.log("small_count App: Month Picker Functionality Loaded.");

      // 7. NEW: Stats Screen Logic (Chart Switching)

      const statsState = {
        period: "month", // week, month, year
        type: "expense", // expense, income
      };

      // æ•°æ®æ¨¡æ‹Ÿ (æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢ç»“æœ) - æŒ‰å‘¨æœŸå’Œç±»å‹ç»„ç»‡
      const chartDataMock = {
        // æ”¯å‡ºæ•°æ®
        expense: {
          week: {
            total: "Â¥ 1,258.60",
            trendColor: "var(--primary)",
            areaFill: "url(#gradientPrimary)",
            // å‘¨æ•°æ®è·¯å¾„ - 7å¤©çš„æ•°æ®ç‚¹
            pathLine: "M0,70 Q42,60 85,80 T170,65 T255,50 T300,40",
            pathArea: "M0,70 Q42,60 85,80 T170,65 T255,50 T300,40 V100 H0 Z",
            xAxisLabels: ["ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "æ—¥"],
            // Donut Gradient
            donutGradient: `conic-gradient(
              var(--primary) 0% 40%,
              var(--accent-orange) 40% 65%,
              var(--accent-blue) 65% 80%,
              var(--border) 80% 100%
            )`,
          },
          month: {
            total: "Â¥ 5,823.40",
            trendColor: "var(--primary)",
            areaFill: "url(#gradientPrimary)",
            // æœˆæ•°æ®è·¯å¾„ - 5ä¸ªæ—¶é—´ç‚¹ï¼ˆæ¯å‘¨ï¼‰
            pathLine: "M0,80 Q30,70 60,40 T120,50 T180,30 T240,60 T300,40",
            pathArea:
              "M0,80 Q30,70 60,40 T120,50 T180,30 T240,60 T300,40 V100 H0 Z",
            xAxisLabels: ["1æ—¥", "7æ—¥", "14æ—¥", "21æ—¥", "28æ—¥"],
            donutGradient: `conic-gradient(
              var(--text-main) 0% 35%,
              var(--primary) 35% 55%,
              var(--accent-orange) 55% 70%,
              var(--accent-blue) 70% 80%,
              var(--border) 80% 100%
            )`,
          },
          year: {
            total: "Â¥ 68,500.00",
            trendColor: "var(--primary)",
            areaFill: "url(#gradientPrimary)",
            // å¹´æ•°æ®è·¯å¾„ - å…¨å¹´è¶‹åŠ¿
            pathLine:
              "M0,90 Q25,80 50,75 T100,60 T150,70 T200,55 T250,40 T300,30",
            pathArea:
              "M0,90 Q25,80 50,75 T100,60 T150,70 T200,55 T250,40 T300,30 V100 H0 Z",
            xAxisLabels: ["1æœˆ", "3æœˆ", "6æœˆ", "9æœˆ", "12æœˆ"],
            donutGradient: `conic-gradient(
              var(--text-main) 0% 30%,
              var(--primary) 30% 50%,
              var(--accent-orange) 50% 65%,
              var(--accent-blue) 65% 75%,
              var(--border) 75% 100%
            )`,
          },
        },
        // æ”¶å…¥æ•°æ®
        income: {
          week: {
            total: "Â¥ 3,200.00",
            trendColor: "var(--accent-orange)",
            areaFill: "url(#gradientOrange)",
            pathLine: "M0,50 Q42,40 85,30 T170,45 T255,35 T300,20",
            pathArea: "M0,50 Q42,40 85,30 T170,45 T255,35 T300,20 V100 H0 Z",
            xAxisLabels: ["ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "æ—¥"],
            donutGradient: `conic-gradient(
              var(--accent-orange) 0% 70%,
              var(--accent-purple) 70% 90%,
              var(--border) 90% 100%
            )`,
          },
          month: {
            total: "Â¥ 12,500.00",
            trendColor: "var(--accent-orange)",
            areaFill: "url(#gradientOrange)",
            pathLine: "M0,60 Q40,50 80,30 T160,20 T240,40 T300,10",
            pathArea: "M0,60 Q40,50 80,30 T160,20 T240,40 T300,10 V100 H0 Z",
            xAxisLabels: ["1æ—¥", "7æ—¥", "14æ—¥", "21æ—¥", "28æ—¥"],
            donutGradient: `conic-gradient(
              var(--accent-orange) 0% 60%,
              var(--accent-purple) 60% 85%,
              var(--border) 85% 100%
            )`,
          },
          year: {
            total: "Â¥ 150,000.00",
            trendColor: "var(--accent-orange)",
            areaFill: "url(#gradientOrange)",
            pathLine:
              "M0,70 Q25,60 50,55 T100,40 T150,50 T200,35 T250,20 T300,10",
            pathArea:
              "M0,70 Q25,60 50,55 T100,40 T150,50 T200,35 T250,20 T300,10 V100 H0 Z",
            xAxisLabels: ["1æœˆ", "3æœˆ", "6æœˆ", "9æœˆ", "12æœˆ"],
            donutGradient: `conic-gradient(
              var(--accent-orange) 0% 55%,
              var(--accent-purple) 55% 80%,
              var(--border) 80% 100%
            )`,
          },
        },
      };

      function updateChartDisplay() {
        // è·å–å½“å‰é€‰ä¸­çš„å‘¨æœŸå’Œç±»å‹çš„æ•°æ®
        const data = chartDataMock[statsState.type][statsState.period];

        // Update Total
        document.getElementById("stats-total-amount").innerText = data.total;

        // Update period label
        const periodLabels = {
          week: "æœ¬å‘¨",
          month: "11æœˆ",
          year: "æœ¬å¹´",
        };
        const typeLabels = {
          expense: "æ€»æ”¯å‡º",
          income: "æ€»æ”¶å…¥",
        };
        document.querySelector(".stats-label").innerText =
          `${periodLabels[statsState.period]} ${typeLabels[statsState.type]}`;

        // Update trend comparison
        const trendComparison = document.querySelector(".stats-trend-tag");
        if (trendComparison) {
          // æ ¹æ®ä¸åŒç±»å‹æ˜¾ç¤ºä¸åŒçš„è¶‹åŠ¿
          if (statsState.type === "expense") {
            trendComparison.innerHTML =
              '<span class="trend-up">â–² 12%</span><span>å¯¹æ¯”ä¸ŠæœŸ</span>';
          } else {
            trendComparison.innerHTML =
              '<span class="trend-up">â–² 8%</span><span>å¯¹æ¯”ä¸ŠæœŸ</span>';
          }
        }

        // Update Trend Chart (SVG)
        const lineEl = document.getElementById("trend-line");
        const areaEl = document.getElementById("trend-area");

        lineEl.style.stroke = data.trendColor;
        areaEl.style.fill = data.areaFill;

        // Simple animation simulation
        lineEl.style.opacity = 0;
        areaEl.style.opacity = 0;
        setTimeout(() => {
          lineEl.setAttribute("d", data.pathLine);
          areaEl.setAttribute("d", data.pathArea);
          lineEl.style.opacity = 1;
          areaEl.style.opacity = 0.2; // Area usually lower opacity
        }, 200);

        // Update Donut Chart
        const donutEl = document.getElementById("category-donut");
        donutEl.style.background = data.donutGradient;

        // Update X-axis labels
        const xAxisContainer = document.querySelector(
          ".chart-container .x-axis"
        );
        if (xAxisContainer) {
          xAxisContainer.innerHTML = data.xAxisLabels
            .map((label) => `<span>${label}</span>`)
            .join("");
        }
      }

      function switchStatsPeriod(el, period) {
        // Update UI
        document
          .querySelectorAll(".segment-btn")
          .forEach((b) => b.classList.remove("active"));
        el.classList.add("active");
        statsState.period = period;

        // æ›´æ–°å›¾è¡¨æ˜¾ç¤º
        updateChartDisplay();
        console.log(`Stats Period switched to: ${period}`);
      }

      function toggleStatsType(type) {
        statsState.type = type;

        // 1. Toggle Buttons
        const btnExp = document.getElementById("btn-stats-exp");
        const btnInc = document.getElementById("btn-stats-inc");

        if (type === "expense") {
          btnExp.classList.add("active");
          btnInc.classList.remove("active");
          document.querySelector(".stats-label").innerText = "11æœˆ æ€»æ”¯å‡º";
        } else {
          btnInc.classList.add("active");
          btnExp.classList.remove("active");
          document.querySelector(".stats-label").innerText = "11æœˆ æ€»æ”¶å…¥";
        }

        // 2. æ›´æ–°å›¾è¡¨æ˜¾ç¤º
        updateChartDisplay();

        // Update List (Simplified for demo - just changing label)
        const listLabel = document.querySelector(
          "#stats-ranking-list"
        ).previousElementSibling;
        listLabel.innerText =
          type === "expense"
            ? "æ”¯å‡ºæ’è¡Œæ¦œ (Top Spending)"
            : "æ”¶å…¥æ¥æº (Income Sources)";
      }

      console.log("small_count App: Stats Redesign Logic Loaded.");
      toggleStatsType("expense");
    </script>
  </body>
</html>
